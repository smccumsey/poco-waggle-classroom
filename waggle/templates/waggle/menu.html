<html>

<head>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>Waggle</title>

    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">


	<script type="text/javascript">
	<!--


		var clients = [];


		function submitOnEnter(myfield, e){
			var keycode;
			if(window.event)
				keycode = window.event.keyCode;
			else if(e)
				keycode = e.which;
			else
				return true;

			if (keycode == 13){
		   		myfield.form.submit();
		   		return false;
		   	}else
		   		return true;
		}

		function getParameterByName(name) {
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		}


		function init(){

			//This gets the session token from the url.
			var token = getParameterByName('session');
			console.log("Token: "+ token);

			if( token != null && token.length > 0 )
				sessionStorage.setItem('token', token);
			else
				token = sessionStorage.getItem('token');


            success('{{object.email}}');

			/*
			//This asks the validate servlet for our username (based on the session token).
			var http = new XMLHttpRequest();
			var params = "token="+token;
			http.open("POST", "../validate", true);

			//Send the proper header information along with the request
			http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			http.onreadystatechange = function() {
				if(http.readyState == 4 && http.status == 200) {
					console.log("Response: "+http.responseText);

					if( http.responseText != null && http.responseText.length > 0 && http.responseText.trim() != "fail" ){

						success(http.responseText.trim());

					//if fail to validate redirect to login page
					}else{

						window.location.href = "login.html";
					}


				}
			}
			http.send(params);
			*/


		}


		function success(username){

			sessionStorage.setItem('username', username);

			$("#username").text(username);


			var clientSelect = document.getElementById("clientSelect");

			if( username == "priyak@uoregon.edu" ){
/*
				var option = document.createElement("option");
				option.text = "Participant 1";
				option.value = "1";
				clientSelect.add(option);

				option = document.createElement("option");
				option.text = "Participant 2";
				option.value = "2";
				clientSelect.add(option);
*/



				var http = new XMLHttpRequest();
				var token = sessionStorage.getItem('token');
				var params = "token="+token;
				http.open("POST", "../getclient", true);

				//Send the proper header information along with the request
				http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

				http.onreadystatechange = function() {
					if(http.readyState == 4 && http.status == 200) {
						console.log("Response: "+http.responseText);

						if( http.responseText != null && http.responseText.length > 0 && http.responseText.trim() != "fail" ){

							//console.log(http.responseText.trim());
							if( http.responseText.trim().length > 2 ){

								clients = JSON.parse(http.responseText.trim());

								for(var i=0; i<clients.length; i++){

									option = document.createElement("option");
									option.text = clients[i].name;
									option.value = clients[i].id;
									clientSelect.add(option);
								}
							}

						}


					}
				}
				http.send(params);

			}else{
				var option = document.createElement("option");
				option.text = "Student 1";
				option.value = "1234";
				clientSelect.add(option);

				option = document.createElement("option");
				option.text = "Student 2";
				option.value = "5678";
				clientSelect.add(option);
			}
		}


		function newClient(){

			var clientname = document.getElementById("clientname").value;
			clientname = clientname.replace("'","");

			var found = false;
			for(var i=0; i<clients.length; i++){
				if( clients[i].name == clientname )
					found = true;
			}

			if( !found ){

				sessionStorage.setItem('clientname', clientname);

				console.log("NEW: "+clientname);

				sessionStorage.setItem('clientid', '1');
				window.location.href = "menu1.html"

/*
				var http = new XMLHttpRequest();
				var token = sessionStorage.getItem('token');
				var params = "token="+token+"&clientname="+clientname;
				http.open("POST", "../newclient", true);

				//Send the proper header information along with the request
				http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

				http.onreadystatechange = function() {
					if(http.readyState == 4 && http.status == 200) {
						console.log("Response: "+http.responseText);

						if( http.responseText != null && http.responseText.length > 0 && http.responseText.trim() != "fail" ){

							console.log(http.responseText);

							sessionStorage.setItem('clientid', http.responseText.trim());

							window.location.href = "menu1.html";

						}

					}
				}
				http.send(params);
*/

			}else{
				alert("Sorry. That client name is already taken.");
			}

		}


		function selectClient(){

			var clientSelect = document.getElementById("clientSelect");
			var clientname = clientSelect.options[clientSelect.selectedIndex].text;
			var clientid = clientSelect.options[clientSelect.selectedIndex].value;

			sessionStorage.setItem('clientname', clientname);
			sessionStorage.setItem('clientid', clientid);

			console.log("SELECT: "+clientname);

			window.location.href = "menu1.html";
		}



	-->
	</script>

</head>


<body onload="init();">

	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <span class="navbar-brand" style="font-size:22px;">Waggle</span>
        </div>
        <div class="navbar-collapse collapse">
          <form class="navbar-form navbar-right" role="form" action="login.html">

          	<span id="username" style="color:#fff;"></span>&nbsp;&nbsp;

            <!--div class="form-group">
              <input type="text" placeholder="Email" class="form-control">
            </div>
            <div class="form-group">
              <input type="password" placeholder="Password" class="form-control">
            </div>
            <button type="submit" class="btn btn-success">Sign in</button-->

            <button type="submit" class="btn btn-danger">Sign out</button>

          </form>
        </div><!--/.navbar-collapse -->
      </div>
    </div>



    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
      	<br/>
        <h2>Welcome to Waggle</h2>
        <p>This would be a good place to say a little something about Waggle.  Below are your modules.  Each module is a set of challenges that will help you build your programming and data science skills.  Click a module below to get started</p>
        <!--p><a class="btn btn-primary btn-lg" role="button">Learn more &raquo;</a></p-->
      </div>
    </div>


    <div class="container">

	  <center>
		  <table style="width:80%;">

            <!-- begin for -->

            {% for entry in object.student.moduleprogress_set.all %}
			<tr>
				<td>
					<nav class="navbar navbar-default">
						<div class="container-fluid">
							<div class="navbar-header" style="padding:15px; width:100%; line-height:150%">
								<div style="float:right;">
									<!--Difficulty:
									<span class="glyphicon glyphicon-star" aria-hidden="true"></span>
									<span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span>
									<span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span>
									<span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span>-->
									Length: 20 minutes
									<br/>
									Progress: 1/4
									<br/>
									<br/>
									<a class="btn btn-primary" href="challenge2.html" role="button">Start this Module</a>
								</div>
                                <b>{{entry.module.name}}</b>
							  	<br/>
							  	Here is a brief description of what this group consists of.
							  	<br/>
							  	Saying anything else here?
							</div>
						 </div>
					 </nav>
				</td>
			</tr>
            {% endfor %}
            <!-- end for -->

		  </table>
      </center>

   	</div>




</body>

</html>
