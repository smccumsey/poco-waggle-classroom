<html>

    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Waggle</title>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="../../static/codemirror/lib/codemirror.css">
        <link rel="stylesheet" href="../../static/codemirror/addon/hint/show-hint.css">


        <style>
            /* The Modal (background) */
            .modal {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                z-index: 1; /* Sit on top */
                padding-top: 100px; /* Location of the box */
                left: 0;
                top: 0;
                width: 100%; /* Full width */
                height: 100%; /* Full height */
                overflow: auto; /* Enable scroll if needed */
                background-color: rgb(0,0,0); /* Fallback color */
                background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            }

            /* Modal Content */
            .modal-content {
                position: relative;
                background-color: #fefefe;
                margin: auto;
                padding: 0;
                border: 1px solid #888;
                width: 80%;
                box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
                -webkit-animation-name: animatetop;
                -webkit-animation-duration: 0.4s;
                animation-name: animatetop;
                animation-duration: 0.4s
            }

            /* Add Animation */
            @-webkit-keyframes animatetop {
                from {top:-300px; opacity:0}
                to {top:0; opacity:1}
            }

            @keyframes animatetop {
                from {top:-300px; opacity:0}
                to {top:0; opacity:1}
            }

            /* The Close Button */
            .close {
                color: white;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }

            .modal-header {
                padding: 2px 16px;
                background-color: #5cb85c;
                color: white;
            }

            .modal-body {padding: 2px 16px;}

            .modal-footer {
                padding: 2px 16px;
                background-color: #5cb85c;
                color: white;
            }


            .CodeMirror {
                height: auto;
            }

            .spinnerbox {
                display:none; /* Hide the DIV */
                position:fixed;
                height:20%;
                width:100%;
                align:center;
                left: 0px;
                top: 278px;
                z-index:100;
                margin-left: 15px;
                padding:15px;
            }

            .modal-dialog {
                padding-top: 10%;
            }

        </style>

        <script src="../../static/codemirror/lib/codemirror.js"></script>
        <script src="../../static/codemirror/addon/hint/show-hint.js"></script>
        <script src="../../static/codemirror/addon/hint/javascript-hint.js"></script>
        <script src="../../static/codemirror/mode/javascript/javascript.js"></script>
        <script src="../../static/codemirror/mode/python/python.js"></script>
        <script src="../../static/codemirror/mode/markdown/markdown.js"></script>

        <script src="../../static/bootstrap/js/bootstrap.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="/../../static/js-cookie/src/js.cookie.js"></script>

        <script src="../../static/jquery/dist/jquery.js"></script>
        <script src="../../static/bootstrap/js/bootstrap.js"></script>

        <!--script src="../../../js/DecimalFormat.js"></script-->


        <!--script src="js/jquery.mobile-1.1.0-rc.1.js"></script-->
        <!--script src="js/jgestures.min.js"></script-->
        <!--<script src="js/jquery.js"></script-->


            <script type="text/javascript">
                <!--

                var notes = [];

                function submitOnEnter(myfield, e){
                    var keycode;
                    if(window.event)
                        keycode = window.event.keyCode;
                    else if(e)
                        keycode = e.which;
                    else
                        return true;

                    if (keycode == 13){
                        myfield.form.submit();
                        return false;
                    }else
                        return true;
                }



function init(){

    var token = sessionStorage.getItem('token');

    //Should we revalidate???
    /*
    //This asks the validate servlet for our username (based on the session token).
    var http = new XMLHttpRequest();
    var params = "token="+token;
    http.open("POST", "../validate", true);

    //Send the proper header information along with the request
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

    http.onreadystatechange = function() {
    if(http.readyState == 4 && http.status == 200) {
    console.log("Response: "+http.responseText);

    if( http.responseText != null && http.responseText.length > 0 && http.responseText.trim() != "fail" ){

    success();

    //if fail to validate redirect to login page
    }else{

    window.location.href = "login.html";
    }


    }
    }
    http.send(params);
     */
    success();



}


function success(){

    var username = sessionStorage.getItem('username');
    var clientname = sessionStorage.getItem('clientname');

    if( clientname != null && clientname.length > 0 )
        $("#username").text(username+" ("+clientname+")");
    else
        $("#username").text(username);


    //load other stuff here?
}



function loadResults(){

    $('#resultsTable').hide();
    $('#previewTable').show();
    $(".spinnerbox").show();

    setTimeout(function(){

            $(".spinnerbox").hide();

            $('#previewTable').hide();
            $('#resultsTable').show();

            },3000);
}


function showHint(num){

    $('#myModal'+num).modal('show')

}


function showMore(){
    $('#less').hide();
    $('#more').show();
}

function showLess(){
    $('#more').hide();
    $('#less').show();
}

function takeNote(pauseOrPlay){

    var video = document.getElementById("video1");
    if( pauseOrPlay )
        video.pause();
    else
        video.play();
}

function saveNote(){

    var video = document.getElementById("video1");

    notes.push({text:$('#newNote').val(),time:video.currentTime});

    var minutes = parseInt( video.currentTime / 60 ) % 60;
    var seconds = Math.round(video.currentTime % 60);
    if( seconds < 10 )
        seconds = "0"+seconds;

    $('#noteTable').append('<tr><td colspan="2">'+$('#newNote').val()+' (<a href="#" onclick="goToNote('+video.currentTime+');">'+minutes+':'+seconds+'</a>)</td></tr>');

    $('#newNote').val("");

    video.play();
}

function goToNote(time){

    var video = document.getElementById("video1");

    video.pause();
    video.currentTime = time;
    video.play();

    return false;
}



function switchToDebug(){

    //if Disqus exists, call it's reset method with new parameters
    DISQUS.reset({
reload: true,
config: function () {
this.page.url = "http://0.0.0.0:8050/waggle/assessment.html";
this.page.identifier = "abc";
}
});

}

function switchToAssessment(){
    //if Disqus exists, call it's reset method with new parameters
    DISQUS.reset({
reload: true,
config: function () {
this.page.url = "http://0.0.0.0:8050/waggle/assessment.html#!assessment";
this.page.identifier = "123";
}
});

}

-->
</script>
<script>

function tellMeMore(){
    // Get the modal
    var modal = document.getElementById('myModal');
    modal.style.display = "block";

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];


    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
            modal.style.display = "none";
        }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
            if (event.target == modal) {
                        modal.style.display = "none";
                            }
                        }
}

function showStatus(short_desc){
    var node;
    var glyph;
    if(short_desc == "CORRECT") {
        node = document.getElementById('status-glyph');
        glyph =  "glyphicon glyphicon-thumbs-up"
    }
    else if(short_desc == "INCORRECT") {
        node = document.getElementById('status-glyph');
        glyph = "glyphicon glyphicon-hand-left"
    }
    else {
        node = document.getElementById('status-glyph');
        glyph = "glyphicon glyphicon-thumbs-down"
    }
    node.setAttribute("class", glyph);
}

function getinput(id, idx){
    alert("you clicked editor #".concat(id));
    var editor_id = "code-".concat(id)
    var edito_contents = editors[idx].getValue()
    var csrftoken = Cookies.get('csrftoken');

    /*console.log(document.getElementById(editor_id));
    console.log(editors[idx].getValue());*/

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });
    $.ajax({
        type: 'POST',
        url: '/waggle/assessment/',
        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
        success: function(data) { alert('YAY data: ' + data); },
    });

}

$('#form').submit(function(e){
    $.post('/waggle/assessment/', $(this).serialize(), function(data){ 
        $('.message').html(data.message);
    });
    e.preventDefault();
});

</script>

</head>


<body onload="init();">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="profile.html" style="font-size:22px;">Waggle</a>
            </div>
            <div class="navbar-collapse collapse">
                <form class="navbar-form navbar-right" role="form" action="login.html">

                    <span id="username" style="color:#fff;"></span>&nbsp;&nbsp;

                    <!--div class="form-group">
                    <input type="text" placeholder="Email" class="form-control">
                </div>
                <div class="form-group">
                    <input type="password" placeholder="Password" class="form-control">
                </div>
                <button type="submit" class="btn btn-success">Sign in</button-->

                    <button type="submit" class="btn btn-danger">Sign out</button>

                </form>
            </div><!--/.navbar-collapse -->
        </div>
    </div>



    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron" style="padding-bottom:15px;">
        <div class="container">
            <br/>
            <img src="../../static/images/i15.png" width="48px" height="48px" style="float:left; margin-right:10px; margin-top:12px;"/>

            <h2>Module</h2>
            <div id="less">
                <p>And you can swap only <b>N*(N-1)/2</b> times, where N - is a quantity of rods. <a href="#" onclick="showMore();">More</a></p>

            </div>
            <div id="more" style="display:none;">
                <p>And you can swap only <b>N*(N-1)/2</b> times, where N - is a quantity of rods.
                <img src="../../static/images/actions.png" width="600px"/>
                <br/>
                <a href="#" style="margin-left:600px;" onclick="showLess();">Less</a></p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-9">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#content" aria-controls="content" role="tab" data-toggle="tab">Content</a></li>
                    <li role="presentation"><a href="#debug" aria-controls="debug" role="tab" data-toggle="tab" onclick="switchToDebug();">Debugging with Steve</a></li>
                    <li role="presentation"><a href="#assessment" aria-controls="assessment" role="tab" data-toggle="tab" onclick="switchToAssessment();">Assessment</a></li>
                    <li role="presentation"><a href="#other" aria-controls="other" role="tab" data-toggle="tab">Other</a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content" style="border: 1px #CCC solid; border-top: 0px; height:60%; overflow-y:auto;">

                    <div role="tabpanel" class="tab-pane active" id="content">
                        {% for content in contents%}
                        <center>
                        </br>
                        
                        <p>Note in order to run code in the notebook displayed below you'll need to download the .ipynb file </p>
                        <p><a href="/media/notebooks/data_intro.ipynb">Download the IPython Notebook</a> </p>
                        <hr>
                        </center>
                        <iframe id="frame" src="/media/notebooks/data_intro.htm" style="border:1px;" height=100% width=100%></iframe>
                        {% endfor %}
                    </div>

                    <div role="tabpanel" class="tab-pane" id="debug">

                        <br/>
                        <video id="video1" width="490" height="280" controls>
                        <source src="../../static/video/name_error.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                        </video>
                        <br/>
                        <table id="noteTable" class="table">
                            <tr>
                                <td style="border:none;">
                                    <textarea id="newNote" rows="2" style="width:100%" onfocus="takeNote(true);" onblur="takeNote(false);"></textarea>
                                </td>
                                <td valign="middle" style="border:none; vertical-align:middle;">
                                    &nbsp;<button type="button" class="btn btn-default" onclick="saveNote();">Save Note</button>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:none;">
                                    <b>Notes:</b>
                                </td>
                                <td style="border:none;">
                                    &nbsp;
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="assessment">
                        <div id=triple>
                        <!-- Start Assessment triple -->
                        {% for assessment in assessments %}
                        <div class="panel panel-default">
                            <div class="panel-heading"><h4>assessment {{assessment.id}}</h4></div>
                            <div class="panel-body"> {{ assessment.description|safe }}
                                <br/>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <!-- CODE EDITOR GOES HERE.-->
                                    <form action="" method="post" style="border:1px solid grey; width:100%; height:200px;">
                                        {% csrf_token %}
<textarea id="code-{{assessment.id }}" name="code_id{{assessment.id}}" style="height:200px;">
{{codefill}}
</textarea>
                                        <br/>
                                        <input class="btn btn-default btn-xs" style="float:right;" type="submit" value="Submit Code" name="code_btn"/>
                                    </form>
                                </div>
                            </div>
                        <div class="panel panel-default">
                            <!-- OUTPUT/TEST RESULTS GO HERE. -->
                            <div class="panel-body">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Status</th>
                                            <th>Name</th>
                                            <th>Short Description</th>
                                            <th>Long Description</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <!-- also include color for status -->
                                                <div id="status-glyph"></div>
                                            </td>
                                            <td>
                                                {{name}}
                                                <!--
                                                in here goes the name for the type of error or hint
                                                -->
                                            </td>
                                            <td>
                                                {{short_desc}}
                                            </td>
                                            <td>
                                                <!--
                                                place button here which calls javascript fxn 
                                                to open popup that diplays output of users code 
                                                submission
                                                -->
                                                <button id="myBtn" class="btn btn-default btn-xs btn-block" onclick="tellMeMore();">Tell me more</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- End triple -->
                        {% endfor %}
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="other">
                        ...
                        {% for realted_item in relateds %}
                        {% endfor %}
                    </div>

                </div>

            </div>

            <div class="col-md-3 col-sm-3">

                <table id="previewTable" style="width:100%;">
                    <tr>
                        <td>
                            <div id="disqus_thread"></div>
                            <script>
                                /**
                                *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                                *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                                */
                                /*

                                TODO: Use this to make various discussion threads unique.

                                var disqus_config = function () {
                                    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
                                    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                                };
                                */

                                var disqus_config = function () {
                                    this.page.url ="http://0.0.0.0:8050/waggle/assessment.html";  // Replace PAGE_URL with your page's canonical URL variable
                                    this.page.identifier = "abc"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                                };

                                (function() {  // DON'T EDIT BELOW THIS LINE
                                    var d = document, s = d.createElement('script');

                                    s.src = 'https:///waggle2.disqus.com/embed.js';

                                    s.setAttribute('data-timestamp', +new Date());
                                    (d.head || d.body).appendChild(s);
                                })();
                            </script>
                            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                        </td>
                    </tr>

                </table>
                <div id="disqus_container_2"></div>
            </div>
        </div>
    </div>

    <div class="spinnerbox">
        <center><img src="../../static/images/spinner.gif"/></center>
    </div>
    <!-- The error Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">×</span>
                <h2>CODE RESULT</h2>
            </div>
            <div class="modal-body">
                <p>{{long_desc}}</p>
            </div>
            <!--
            <div class="modal-footer">
                <h3>Modal Footer</h3>
            </div>
            -->
        </div>

    </div>

    <div id="myModal1" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">assessment Hint</h4>
                </div>
                <div class="modal-body">
                    <!--p> </p-->

                    <iframe width="560" height="315" src="https://www.youtube.com/embed/cWhUxw8v404" frameborder="0"></iframe>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <!--button type="button" class="btn btn-primary">Save changes</button-->
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="myModal2" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">assessment Hint</h4>
                </div>
                <div class="modal-body">
                    <!--p> </p-->

                    <video width="560" height="380" controls>
                    <source src="../../static/video/name_error.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                    </video>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <!--button type="button" class="btn btn-primary">Save changes</button-->
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <script>
        var editors = [];
        {% for assessment in assessments %}
        editors[{{forloop.counter0}}] = CodeMirror.fromTextArea(document.getElementById("code-{{assessment.id}}"), {
            mode: {name: "python",
                version: 3,
                singleLineStringErrors: false},
            lineNumbers: true,
            indentUnit: 4,
            matchBrackets: true,
        });
        setTimeout(function() {
            editors[{{forloop.counter0}}].refresh()
        }, 1);


        {% endfor %}
    </script>


</body>
</html>
